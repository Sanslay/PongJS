<html>
<head>
<script src="/socket.io/socket.io.js"></script>
<script src="raphael.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>

</head>
<title>
PongJS
</title>
<body>
<script type="text/javascript">

 

//ADRESSE DU SERVER FIXE A CHANGER
// Configuration de la page web
var serverAddr = '192.168.1.53:8080';
// Configuration du paper Raphael: TAILLE
var pWidth = 800;
var pHeight = 500;

var pWidth1 = 400;//largeur
var pHeight1 = 50;//hauteur

// Configuration des rect Raphael: COULEUR
var p1Color = "#4f23cf";
var p2Color = "#cf2323";
// Configuration des circle Raphael: COULEUR
var ballColor = "#37cf23";
var ballRadius = 20;
//Nombre de joueur initialise
var player = 0;
//***********CREATION FORMULAIRE
var valid=false;

//*******ON VALIDE******//
/**************On crée les images sur le paper Raphael **************/

// Cree le paper
var paper = Raphael(500, 0, pWidth, pHeight);
var rec = paper.rect(0, 0, pWidth, pHeight, 10);
// Cree les carre joueur et les balles
//J1
var p1 = paper.rect(0, pHeight/2 - 50, 20, 100, 5);
p1.attr("fill", p1Color);
//J2
var p2 = paper.rect(pWidth - 20, pHeight/2 - 50, 20, 100, 5);
p2.attr("fill", p2Color);
//BALL
var ball = paper.circle(pWidth/2, pHeight/2, ballRadius);
ball.attr("fill", ballColor);

//On crée le paper du score
var paperText= Raphael(85, 350, pWidth1, pHeight1);
//Bordure
// var rec = paper1.rect(0, 0, pWidth1, pHeight1, 5);
//texte
var texte=paperText.text(140,10,"");
texte.attr('font-size',16);
//On part du principe que l'on a 2 joueur
var players = [p1, p2];


// On cree une connection avec le socket à l'adresse

var socket = io.connect(serverAddr);


//Ecoute de message de type connect lorsque on est connecter au server
socket.on('connect', function(){

//Action effectuer losque que l'on recoi le message

//On attend le nombre de joueur

socket.on('player-number', function(data) {
//On recupere le nombre de joueur
player = data;

console.log("Vous etes le joueur"+ player);

var cell, ligne;

//On crée le html d'info joueur
var tableau = document.getElementById("idStatutjoueur");
var nbLignes = tableau.rows.length;
tableau.deleteRow(-1)
ligne = tableau.insertRow(-1); // création d'une ligne pour ajout en fin de table
// le paramètre est dans ce cas (-1)

// création et insertion des cellules dans la nouvelle ligne créée
cell = ligne.insertCell(0);


if(player==0)
{
cell.innerHTML = "Vous etes le  joueur bleu" ;
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);

cell.innerHTML = "Name" ;

//creationinput
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);
var input = document.createElement("input" ) ;
        input.type = "text" ;
        input.value = "Name?" ;
        input.id = "idname" ;
		input.style=	"width:180px;";
        input.setAttribute("onClick","javascript:Pret();") ;

		cell.appendChild(input) ;
		
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);
		
var combo = document.createElement("select" ) ;
        combo.type = "text" ;
        combo.id = "thelists" ;
        combo.setAttribute("onChange","combo(this)") ;
		cell.appendChild(combo) ;
var myselect = document.getElementById('thelists');
myselect.add(new Option("Tres Facile", "0"));
myselect.add(new Option("Facile", "0"));
myselect.add(new Option("Moyen", "0"));
myselect.add(new Option("Difficile", "0"));
myselect.add(new Option("Tres Difficile", "0"));
		


ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);

cell.innerHTML = "Score" ;
//creationinput
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);

var input = document.createElement("input" ) ;
        input.type = "text" ;
        input.value = "Score?" ;
		input.id = "textScore" ;
        input.name = "idscore" ;
		input.style=	"width:180px;";
        input.setAttribute("onClick","javascript:Pret();") ;

		cell.appendChild(input) ;
		
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);


//creationbouton
var button = document.createElement("input" ) ;
        button.type = "button" ;
        button.value = "Pret?" ;
        button.name = "idPret" ;
		button.style=	"width:180px;";
        button.setAttribute("onClick","javascript:Pret();") ;

		cell.appendChild(button) ;	

}
if(player==1)
{
cell.innerHTML = "Vous etes le joueur rouge" ;
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);

cell.innerHTML = "Name" ;

//creationinput
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);
var input = document.createElement("input" ) ;
        input.type = "text" ;
		input.id = "idname" ;;
        input.value = "Name?" ;
		input.style=	"width:180px;";
        input.setAttribute("onClick","javascript:Pret();") ;

		cell.appendChild(input) ;
		
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);
		
var combo = document.createElement("select" ) ;
        combo.type = "text" ;
		combo.name="thelist";
        combo.id = "thelists" ;
        combo.setAttribute("onChange","combo(this)") ;
		cell.appendChild(combo) ;
var myselect = document.getElementById('thelists');
myselect.add(new Option("Tres Facile", "0"));
myselect.add(new Option("Facile", "0"));
myselect.add(new Option("Moyen", "0"));
myselect.add(new Option("Difficile", "0"));
myselect.add(new Option("Tres Difficile", "0"));
		

ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);

cell.innerHTML = "Score" ;
//creationinput
ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);

var input = document.createElement("input" ) ;
        input.type = "text" ;
        input.value = "Score?" ;
		input.id = "textScore" ;
        input.name = "idscore" ;
		input.style=	"width:180px;";
        input.setAttribute("onClick","javascript:Pret();") ;

		cell.appendChild(input) ;

ligne = tableau.insertRow(-1);
cell = ligne.insertCell(0);

//creationbouton
var button = document.createElement("input" ) ;
        button.type = "button" ;
        button.value = "Pret?" ;
        button.name = "idname" ;
		button.style=	"width:180px;";
        button.setAttribute("onClick","javascript:Pret();") ;

		cell.appendChild(button) ;
	
}

if(player==3)
{
cell.innerHTML = "Vous etes un visiteur le jeu et deja en cours" ;
document.body.removeChild(document.getElementById('idboutonpret'));

}
});


//On envoi un message lorsque l'on perd le server
socket.on('disconnect', function(data)
{
alert("SERVER STOP ");
});

//On attend les positions joueur adverse
socket.on('opponents-position', function(data) {
players[(player + 1) % 2].attr("y", data);
});

//Gestion des positions raquette client
socket.on('position-raquette', function(data) {

if(player==3)
{
players[0].attr("y", data[0]);
players[1].attr("y", data[1]);
}

});

//On attend les positions de la ball
socket.on('ball-position', function (data) {

// ils seront ecrit directement dans les ball
ball.attr("cx", data.x);
ball.attr("cy", data.y);
});


//On attend le changement de vitesse
socket.on('vitesse-change', function (data) {
var cell, ligne;

//On crée le html d'info joueur
var tableau = document.getElementById("idBoxvitesse");
var nbLignes = tableau.rows.length;
tableau.deleteRow(0)
ligne = tableau.insertRow(-1); // création d'une ligne pour ajout en fin de table

// création et insertion des cellules dans la nouvelle ligne créée
cell = ligne.insertCell(0);
cell.innerHTML = "s";
cell.innerHTML = "La nouvelle vitesse est de "+ data +"%";


});

socket.on('game-score', function (data) {

var cell, ligne;

//On crée le html d'info joueur
var tableau = document.getElementById("idBox");
var nbLignes = tableau.rows.length;
if(nbLignes>0)
{
tableau.deleteRow(-1)
}


ligne = tableau.insertRow(-1); // création d'une ligne pour ajout en fin de table

// création et insertion des cellules dans la nouvelle ligne créée
cell = ligne.insertCell(0);

cell.innerHTML = "Joueur Bleu: "+data[1]+" - "+data[0]+" Joueur Rouge";
});

//On attend que un joueur ce deconnecte
socket.on('opponent-disconnected', function(data) {
alert("Deconnection du joueur "+data);
location.reload()

});

//On attend que la ball touche une raquette
socket.on('squish', function() {
//On crée l'annimation sur la ball
var anim = Raphael.animation({r: ballRadius}, 500, "bounce");

ball.attr('r', ballRadius - 5);
ball.animate(anim);
});

});

// Mouvement de souris
(function() {
window.onmousemove = handleMouseMove;
function handleMouseMove(event)
{
//Le joueur 3 (spectateur) ne pouvant pas jouers
if(player!=3)
{
event = event || window.event;
//On change que les valeurs de Y au numero defini par data
var y = event.clientY;
var x = event.clientX;

if(y>=(pHeight-100)){
y=pHeight-110;}
//console.log(y);
//console.log(x);
players[player].attr("y", y+3);
socket.emit('player-position', y+3);
}
}
})();

function combo(thelist)
{
if(player!=3)
{
var vitesse = thelists.selectedIndex;
var data=[player, vitesse];

socket.emit('game-vitesse', data);
}
else
{
alert("Il est impossible pour une visiteur de changer la vitesse");
}
}

function Pret()
{
console.log("boutonPret");
var vitesse = thelists.selectedIndex;
data=[player,idname.value,vitesse,textScore.value]
console.log(data);
data=player;

socket.emit('joueur-pret', data);
//console.log(idname.value);

//console.log(vitesse);
//console.log(textScore.value);

}


</script>
<h1 style="margin-left: 100px;">Jeu PING PONG</h1>
<h2 style=" margin-left: 100;">Information du jeu</h2>

<button style=" margin-left: 100;" onclick="javascript:location.reload();">Recharger la page</button>
<table id="idTable" style=" margin-left: 100px;">

</table>
<table id="idBox" style=" margin-left: 100px;">
<tr>
</tr>
</table>
<table id="idBoxvitesse" style=" margin-left: 100px;">
<tr>
</tr>
</table>

<select size="10" name="tchat"style="width: 180px; border-bottom-style: solid; border-bottom-width: 0px; padding-bottom: 0px; margin-left: 1320px; padding-right: 0px; border-right-style: solid; margin-right: 50px; border-left-style: solid; border-right-width: 0px;">
	<option selected>Plan 1
	<option>Plan 2
	<option>Plan 3
	<option>coucou u pu du cu

</select> 
<table id="idStatutjoueur" style="  margin-left: 800px; margin-top: 210px;">
<tr>
</tr>
</table>



</body>

</html>
